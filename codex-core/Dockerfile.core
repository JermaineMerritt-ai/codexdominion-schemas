FROM rust:1.83 as builder
WORKDIR /app
COPY codex-core/Cargo.toml codex-core/Cargo.lock ./
COPY codex-core/src ./src
RUN cargo build --release

FROM gcr.io/distroless/cc
ENV CODEX_CORE_PATH=/app/core/codex-core
COPY --from=builder /app/target/release/codex-core /app/core/codex-core
EXPOSE 8080
ENTRYPOINT ["/app/core/codex-core"]
