services:
  db:
    image: postgres:16
    environment:
      POSTGRES_USER: codex
      POSTGRES_PASSWORD: codex
      POSTGRES_DB: dominion
    ports: ["5432:5432"]
    volumes:
      - postgres_data:/var/lib/postgresql/data
  redis:
    image: redis:7
    ports: ["6379:6379"]
    volumes:
      - redis_data:/data
  api:
    build: ../apps/api
    environment:
      DATABASE_URL: postgres://codex:codex@db:5432/dominion
      REDIS_URL: redis://redis:6379
      JWT_SECRET: "change-me-in-production"
      EMAIL_FROM: "broadcast@codexdominion.org"
      API_PORT: "4000"
    ports: ["4000:4000"]
    depends_on:
      - db
      - redis
  # dashboard:
  #   build: ../apps/dashboard
  #   environment:
  #     NEXT_PUBLIC_API_URL: http://localhost:4000
  #   ports: ["3000:3000"]
  #   depends_on: [api]

volumes:
  postgres_data:
  redis_data:
