[Unit]
Description=Codex Dashboard - Production Flame
After=network.target network-online.target
Wants=network-online.target

[Service]
Type=simple
WorkingDirectory=/var/www/codex
ExecStart=/usr/local/bin/streamlit run codex_dashboard.py --server.port=8501 --server.address=127.0.0.1 --server.headless=true --browser.gatherUsageStats=false
Restart=always
RestartSec=10
User=www-data
Group=www-data

# Security settings
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/www/codex
PrivateTmp=true

# Environment variables
Environment=PYTHONPATH=/var/www/codex
Environment=STREAMLIT_SERVER_HEADLESS=true
Environment=STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
Environment=STREAMLIT_SERVER_PORT=8501
Environment=STREAMLIT_SERVER_ADDRESS=127.0.0.1

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=codex-dashboard

# Resource limits
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target