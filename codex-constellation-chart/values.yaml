rollouts:
  enabled: true
  strategy: canary
  steps:
    - setWeight: 20
    - pause: { duration: 60 }
    - setWeight: 50
    - pause: { duration: 120 }
    - setWeight: 100
  analysis:
    enabled: true
    interval: 30
    successCondition: result[0] >= 0.99
    failureCondition: result[0] < 0.95
    metric:
      name: orchestrator-success-ratio
      query: |
        sum(rate(http_requests_total{job="orchestrator",status=~"2.."}[5m])) /
        sum(rate(http_requests_total{job="orchestrator"}[5m]))

global:
  registry: ghcr.io/your-org

core:
  name: codex-core
  port: 8081
  image: ghcr.io/your-org/codex-core:latest
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

orchestrator:
  name: orchestrator
  port: 8000
  image: ghcr.io/your-org/orchestrator:latest
  replicas: 3
  env:
    CORE_HOST: codex-core
    CORE_PORT: '8081'
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 70

engines:
  - name: engine01
    port: 8080
    image: ghcr.io/your-org/engine01:latest
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
  - name: engine02
    port: 8082
    image: ghcr.io/your-org/engine02:latest
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70

monitoring:
  prometheus:
    image: prom/prometheus:latest
    port: 9090
  grafana:
    image: grafana/grafana:latest
    port: 3000

codexCore:
  replicas: 3
  image: codex-core:prod
  port: 8081
