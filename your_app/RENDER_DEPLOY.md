# Codex Dominion Backend - Render Deployment Guide

## üöÄ Quick Deploy to Render

### Prerequisites
- GitHub account connected to Render
- Code pushed to GitHub repository

### Deployment Steps

#### 1. Create New Web Service
1. Go to https://dashboard.render.com
2. Click **"New +"** ‚Üí **"Web Service"**
3. Connect your GitHub repository: `JermaineMerritt-ai/codexdominion-schemas`
4. Select branch: `main`

#### 2. Configure Service
**Basic Settings:**
- **Name:** `codexdominion-backend` (or your choice)
- **Region:** Oregon (US West) - Free tier available
- **Branch:** main
- **Root Directory:** `your_app`
- **Environment:** Python 3

**Build & Deploy:**
- **Build Command:** `pip install -r requirements.txt`
- **Start Command:** `gunicorn app:app --config gunicorn_config.py`

**Instance Type:**
- Select **Free** tier

#### 3. Add PostgreSQL Database
1. In the same page, scroll to **"Add Database"**
2. Click **"New PostgreSQL"**
3. Settings:
   - **Name:** `codexdominion-db`
   - **Database:** `codexdominion`
   - **User:** `codexdominion`
   - **Region:** Same as web service (Oregon)
   - **Plan:** Free (expires after 90 days)
4. Click **"Create Database"**

#### 4. Configure Environment Variables
Render will auto-create these. Add custom ones:

**Required Variables:**
```
DATABASE_URL=<auto-populated from PostgreSQL>
SECRET_KEY=<auto-generated by Render>
FLASK_ENV=production
FLASK_APP=app.py
PYTHON_VERSION=3.11.0
```

**Optional for Stock APIs:**
```
ALPHA_VANTAGE_API_KEY=your_key_here
POLYGON_API_KEY=your_key_here
NEWS_API_KEY=your_key_here
```

**CORS Configuration (add after frontend deploys):**
```
CORS_ORIGINS=https://codexdominion-schemas.onrender.com,http://localhost:3000
```

#### 5. Deploy
1. Click **"Create Web Service"**
2. Wait 3-5 minutes for build
3. Check logs for successful startup

#### 6. Initialize Database
After deployment succeeds:

1. Go to **Shell** tab in Render dashboard
2. Run:
```bash
python init_db.py
```

This creates all tables (Portfolio, Holdings, Transactions, StockPrice, etc.)

#### 7. Verify Deployment
Test endpoints:
```bash
# Health check
curl https://codexdominion-backend.onrender.com/

# Auth endpoint
curl https://codexdominion-backend.onrender.com/auth/login

# Stocks endpoint
curl https://codexdominion-backend.onrender.com/stocks/picks
```

Expected: JSON responses, no errors

---

## üîó Connect to Frontend

After backend deploys, update frontend environment:

**File: `web/.env.production`**
```env
NEXT_PUBLIC_API_URL=https://codexdominion-backend.onrender.com
```

**Backend CORS:** Add in Render environment variables:
```
CORS_ORIGINS=https://codexdominion-schemas.onrender.com
```

Redeploy both services after updating.

---

## üêõ Troubleshooting

### Build Fails
- Check `requirements.txt` is in `your_app/` directory
- Verify Python version compatibility
- Check logs for specific package errors

### Database Connection Fails
- Ensure DATABASE_URL is set
- Verify PostgreSQL database is created
- Check database is in same region

### Gunicorn Won't Start
- Verify `gunicorn_config.py` exists in `your_app/`
- Check `app.py` has `app = create_app()` or similar
- Review logs for import errors

### CORS Errors
- Add frontend URL to CORS_ORIGINS
- Restart backend service
- Clear frontend cache

---

## üìä Expected Timeline

- **Database creation:** 2-3 minutes
- **Backend build:** 3-5 minutes
- **Frontend deploy:** 2-3 minutes (separate)
- **Total setup:** ~10-15 minutes

---

## üéØ Post-Deployment

1. ‚úÖ Backend live at: `https://codexdominion-backend.onrender.com`
2. ‚úÖ Frontend live at: `https://codexdominion-schemas.onrender.com`
3. ‚úÖ Database initialized with 8 tables
4. ‚úÖ CORS configured for frontend-backend communication
5. ‚úÖ Test login functionality
6. ‚úÖ Verify stock picks display
7. ‚úÖ Confirm portfolio data loads

---

## üî• Your Digital Sovereignty Awaits! üëë
